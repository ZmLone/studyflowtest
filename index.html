<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow - Master Your Prep</title>
    
    <!-- Performance Optimization: Preconnect & DNS Prefetch -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.gstatic.com">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Defer non-critical scripts to unblock rendering -->
 <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>   
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable manual dark mode toggle
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e', 950: '#082f49' },
                        backlog: { 50: '#fff7ed', 100: '#ffedd5', 500: '#f97316', 600: '#ea580c' },
                        // Custom dark mode palette adjustments
                        dark: {
                            bg: '#020617', // Slate 950
                            card: '#0f172a', // Slate 900
                            border: '#1e293b' // Slate 800
                        }
                    }
                }
            }
        }
    </script>
    <script>
        // Inline script to prevent FOUC (Flash of Unstyled Content) and default to DARK
        if (localStorage.theme === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="h-screen w-screen overflow-hidden text-slate-100" id="app-body">
    
    <div class="live-bg"></div>
    <div class="noise"></div>

    <div class="flex h-full w-full p-0 md:p-6 gap-6">

        <nav class="hidden md:flex flex-col w-24 h-full glass rounded-[32px] items-center py-8 z-50">
            <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-black mb-12 shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                <i data-lucide="layers" class="w-6 h-6"></i>
            </div>

            <div class="flex-1 flex flex-col gap-6 w-full px-4">
                <button onclick="switchView('overview')" id="nav-overview" class="nav-pill active aspect-square flex items-center justify-center rounded-2xl" title="Overview">
                    <i data-lucide="layout-grid" class="w-6 h-6"></i>
                </button>
                <button onclick="switchView('target')" id="nav-target" class="nav-pill aspect-square flex items-center justify-center rounded-2xl" title="Target">
                    <i data-lucide="crosshair" class="w-6 h-6"></i>
                </button>
                <button onclick="switchView('backlog')" id="nav-backlog" class="nav-pill aspect-square flex items-center justify-center rounded-2xl" title="Backlog">
                    <i data-lucide="history" class="w-6 h-6"></i>
                </button>
                <button onclick="switchView('leaderboard')" id="nav-leaderboard" class="nav-pill aspect-square flex items-center justify-center rounded-2xl" title="Leaderboard">
                    <i data-lucide="trophy" class="w-6 h-6"></i>
                </button>
                <button onclick="switchView('planner')" id="nav-planner" class="nav-pill aspect-square flex items-center justify-center rounded-2xl" title="Planner">
                    <i data-lucide="calendar" class="w-6 h-6"></i>
                </button>
                <button onclick="switchView('namaz')" id="nav-namaz" class="nav-pill aspect-square flex items-center justify-center rounded-2xl" title="Spiritual">
                    <i data-lucide="moon" class="w-6 h-6"></i>
                </button>
            </div>

            <button onclick="openProfileModal()" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors">
                <i data-lucide="user" class="w-5 h-5"></i>
            </button>
        </nav>

        <main class="flex-1 relative h-full rounded-[0px] md:rounded-[32px] overflow-hidden glass shadow-2xl">
            
            <header class="absolute top-0 left-0 right-0 h-20 flex items-center justify-between px-8 z-20 bg-gradient-to-b from-black/50 to-transparent">
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-black tracking-tight text-white flex items-center gap-2">
                        StudyFlow <span class="text-xs bg-white/10 px-2 py-1 rounded-full text-slate-300 font-medium tracking-wide">PRO</span>
                    </h1>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex flex-col items-end">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest" id="overview-date">...</span>
                        <span class="text-sm font-bold text-white" id="agenda-date-display">Today</span>
                    </div>
                    <button onclick="openPrayerModal()" class="glass px-4 py-2 rounded-full flex items-center gap-2 hover:bg-white/10 transition-all">
                        <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                        <span class="text-xs font-bold" id="header-prayer-count">0/5</span>
                    </button>
                </div>
            </header>

            <div class="absolute inset-0 top-20 overflow-y-auto custom-scroll p-4 md:p-8 pb-32 md:pb-8">
                
                <div id="view-overview" class="max-w-6xl mx-auto space-y-8 animate-in fade-in zoom-in duration-300">
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-2 glass-card p-8 relative overflow-hidden group">
                            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/20 rounded-full blur-[80px] group-hover:bg-blue-500/30 transition-all"></div>
                            
                            <div class="relative z-10">
                                <span class="inline-block px-3 py-1 rounded-full bg-blue-500/20 border border-blue-400/30 text-blue-200 text-xs font-bold uppercase tracking-wider mb-4">Current Mission</span>
                                <h2 class="text-4xl md:text-5xl font-black text-white mb-2" id="card-main-name">Loading...</h2>
                                <div class="flex items-end gap-2 mb-8">
                                    <span class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300" id="card-main-days">--</span>
                                    <span class="text-sm font-bold text-slate-400 mb-3 uppercase tracking-widest">Days Remaining</span>
                                </div>
                                
                                <div class="w-full bg-white/5 h-2 rounded-full overflow-hidden">
                                    <div id="card-main-bar" class="h-full bg-blue-500 shadow-[0_0_20px_rgba(59,130,246,0.5)] w-0 transition-all duration-1000"></div>
                                </div>
                                <div class="flex justify-between mt-2 text-xs font-medium text-slate-400">
                                    <span>Progress</span>
                                    <span id="card-main-text" class="text-white">0%</span>
                                </div>
                            </div>
                        </div>

                        <div onclick="switchView('backlog')" class="glass-card p-6 flex flex-col justify-between cursor-pointer hover:bg-white/5 relative overflow-hidden">
                            <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-orange-500/20 rounded-full blur-[60px]"></div>
                            <div>
                                <div class="flex justify-between items-start">
                                    <div class="p-3 bg-orange-500/20 rounded-2xl text-orange-400"><i data-lucide="history" class="w-6 h-6"></i></div>
                                    <i data-lucide="arrow-up-right" class="w-5 h-5 text-slate-500"></i>
                                </div>
                                <div class="mt-6">
                                    <span class="text-4xl font-black text-white" id="backlog-days-large">--</span>
                                    <p class="text-xs font-bold text-slate-400 uppercase mt-1">Recovery Days</p>
                                </div>
                            </div>
                            <div class="w-full bg-white/5 h-1.5 rounded-full mt-4 overflow-hidden">
                                <div id="card-backlog-bar" class="h-full bg-orange-500 w-0 transition-all"></div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="list-todo" class="w-5 h-5 text-purple-400"></i> Today's Focus
                        </h3>
                        <div id="ai-strategy-container" class="hidden mb-6"></div>
                        
                        <div id="overview-task-list" class="space-y-3 min-h-[200px]">
                            </div>
                    </div>

                    <div class="sticky bottom-4 z-30">
                         <form id="add-task-form" class="glass p-2 rounded-[24px] flex items-center gap-2 shadow-2xl backdrop-blur-xl">
                            <div class="pl-4"><i data-lucide="plus" class="text-slate-400"></i></div>
                            <input type="text" id="new-task-input" placeholder="Add a new task..." 
                                class="bg-transparent border-none text-white placeholder-slate-500 focus:ring-0 w-full py-3 outline-none">
                            
                            <select id="new-task-type" class="bg-white/10 border-none text-xs font-bold text-white rounded-xl px-3 py-2 outline-none cursor-pointer">
                                <option value="main" class="text-black">Exam</option>
                                <option value="backlog" class="text-black">Backlog</option>
                            </select>

                            <select id="new-task-subject" class="bg-white/10 border-none text-xs font-bold text-white rounded-xl px-3 py-2 outline-none cursor-pointer" onchange="updateFooterProgress()">
                                <option value="General" class="text-black">General</option>
                                <option value="Physics" class="text-black">Phy</option>
                                <option value="Chemistry" class="text-black">Chem</option>
                                <option value="Botany" class="text-black">Bot</option>
                                <option value="Zoology" class="text-black">Zoo</option>
                            </select>
                            
                            <button type="submit" class="bg-white text-black p-3 rounded-xl hover:scale-105 transition-transform">
                                <i data-lucide="arrow-up" class="w-5 h-5"></i>
                            </button>
                        </form>
                    </div>

                </div>
                <div id="view-target" class="hidden animate-in fade-in zoom-in duration-300">
                    <h2 class="text-3xl font-bold mb-6 text-white" id="syllabus-title">Syllabus</h2>
                    <input type="text" onkeyup="handleSearch(this.value, 'main')" placeholder="Search..." class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-white mb-6 outline-none focus:border-blue-500 transition-colors">
                    <div id="main-syllabus-container" class="space-y-4"></div>
                    <div id="syllabus-date" class="hidden"></div>
                    <div id="syllabus-days-left" class="hidden"></div>
                </div>

                <div id="view-backlog" class="hidden animate-in fade-in zoom-in duration-300">
                    <h2 class="text-3xl font-bold mb-6 text-white">Backlog Recovery</h2>
                    <input type="text" onkeyup="handleSearch(this.value, 'backlog')" placeholder="Search backlog..." class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-white mb-6 outline-none focus:border-orange-500 transition-colors">
                    <div id="backlog-syllabus-container" class="space-y-4"></div>
                    <div id="backlog-days-left" class="hidden"></div>
                </div>

                <div id="view-leaderboard" class="hidden animate-in fade-in zoom-in duration-300">
                    <h2 class="text-3xl font-bold mb-6 text-white">Leaderboard</h2>
                     <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                        <button onclick="switchRankTab('overall')" id="tab-overall" class="px-4 py-2 bg-white text-black rounded-xl text-xs font-bold">Overall</button>
                        <button onclick="switchRankTab('exam')" id="tab-exam" class="px-4 py-2 bg-white/10 text-white rounded-xl text-xs font-bold">Exam %</button>
                        <button onclick="switchRankTab('backlog')" id="tab-backlog" class="px-4 py-2 bg-white/10 text-white rounded-xl text-xs font-bold">Backlog</button>
                        <button onclick="switchRankTab('tests')" id="tab-tests" class="px-4 py-2 bg-white/10 text-white rounded-xl text-xs font-bold">Tests</button>
                    </div>
                    
                    <div class="glass-card p-6 mb-6 flex items-center justify-between bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border-yellow-500/30">
                        <div>
                            <p class="text-xs font-bold text-yellow-200 uppercase tracking-widest">Your Rank</p>
                            <h3 class="text-2xl font-bold text-white" id="lb-user-name">Loading...</h3>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl font-black text-yellow-400" id="lb-my-rank">#--</div>
                        </div>
                         <div id="lb-my-exam" class="hidden"></div>
                         <div id="lb-my-backlog" class="hidden"></div>
                         <div id="lb-my-tests" class="hidden"></div>
                    </div>
                    
                    <div id="leaderboard-list" class="space-y-2"></div>
                </div>
                
                 <div id="view-planner" class="hidden animate-in fade-in zoom-in duration-300">
                     <h2 class="text-3xl font-bold mb-6 text-white">Day Planner</h2>
                     <div class="flex bg-white/10 rounded-xl p-1 w-fit mb-6">
                        <button onclick="setPlannerTab('unscheduled')" id="tab-unscheduled" class="px-4 py-2 rounded-lg text-xs font-bold text-white bg-white/20">To Plan</button>
                        <button onclick="setPlannerTab('scheduled')" id="tab-scheduled" class="px-4 py-2 rounded-lg text-xs font-bold text-slate-400">Schedule</button>
                    </div>
                     <div id="planner-section-unscheduled">
                         <div id="planner-pool-list" class="space-y-4"></div>
                         <div class="mt-8">
                             <input type="text" id="planner-new-text" class="hidden"> <button onclick="document.getElementById('add-task-form').scrollIntoView()" class="w-full py-3 bg-white/10 rounded-xl text-sm font-bold border border-white/10 border-dashed">Use Overview to Add Tasks</button>
                         </div>
                     </div>
                     <div id="planner-section-scheduled" class="hidden">
                         <div id="planner-schedule-list" class="space-y-4"></div>
                         <div id="planner-completed-container" class="hidden mt-8">
                            <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">Completed</h4>
                            <div id="planner-completed-list" class="space-y-2 opacity-50"></div>
                         </div>
                     </div>
                 </div>

                 <div id="view-namaz" class="hidden animate-in fade-in zoom-in duration-300">
                    <h2 class="text-3xl font-bold mb-6 text-white">Spiritual</h2>
                    <div class="glass-card p-8 mb-6 text-center">
                        <span class="block text-5xl font-black text-white mb-2" id="ramadan-days-left">--</span>
                        <span class="text-xs font-bold text-emerald-400 uppercase tracking-widest">Days until Ramadan</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="glass-card p-4">
                            <div class="text-xs font-bold text-slate-400 uppercase">Strongest</div>
                            <div class="text-xl font-bold text-white" id="insight-best">...</div>
                        </div>
                        <div class="glass-card p-4">
                            <div class="text-xs font-bold text-slate-400 uppercase">Needs Focus</div>
                            <div class="text-xl font-bold text-white" id="insight-worst">...</div>
                        </div>
                    </div>
                    <p class="mt-8 text-center text-lg font-serif italic text-slate-300" id="daily-hadith-text">...</p>
                    <p class="text-center text-xs font-bold text-slate-500 mt-2" id="daily-hadith-source">...</p>
                 </div>
                 
                 <div id="view-mistakes" class="hidden animate-in fade-in zoom-in duration-300">
                     <div id="notebook-shelf" class="text-center py-20">
                         <h2 class="text-3xl font-bold text-white mb-8">Mistake Notebooks</h2>
                         <div class="grid grid-cols-1 gap-4">
                             <div onclick="openNotebook('Physics')" class="glass-card p-6 cursor-pointer hover:bg-blue-500/20 border-l-4 border-l-blue-500 text-left">
                                 <h3 class="text-xl font-bold">Physics</h3>
                                 <div id="count-physics" class="text-xs text-slate-400">0 Errors</div>
                             </div>
                             <div onclick="openNotebook('Chemistry')" class="glass-card p-6 cursor-pointer hover:bg-orange-500/20 border-l-4 border-l-orange-500 text-left">
                                 <h3 class="text-xl font-bold">Chemistry</h3>
                                 <div id="count-chemistry" class="text-xs text-slate-400">0 Errors</div>
                             </div>
                             <div onclick="openNotebook('Biology')" class="glass-card p-6 cursor-pointer hover:bg-green-500/20 border-l-4 border-l-green-500 text-left">
                                 <h3 class="text-xl font-bold">Biology</h3>
                                 <div id="count-biology" class="text-xs text-slate-400">0 Errors</div>
                             </div>
                         </div>
                     </div>
                     <div id="notebook-content" class="hidden h-full flex flex-col">
                         <div class="flex items-center gap-4 mb-6">
                             <button onclick="closeNotebook()" class="p-2 bg-white/10 rounded-full"><i data-lucide="arrow-left"></i></button>
                             <h2 class="text-2xl font-bold" id="notebook-title">Notebook</h2>
                         </div>
                         <button onclick="document.getElementById('add-mistake-modal').classList.remove('hidden')" class="w-full py-3 bg-white text-black font-bold rounded-xl mb-4">Log New Mistake</button>
                         <div id="notebook-entries" class="space-y-4"></div>
                         <input type="hidden" id="mistake-subject-display">
                     </div>
                 </div>

            </div>
        </main>
    </div>

    <nav class="md:hidden fixed bottom-6 left-6 right-6 h-16 glass rounded-full flex items-center justify-around px-2 z-50 shadow-[0_10px_40px_rgba(0,0,0,0.5)]">
        <button onclick="switchView('overview')" class="p-3 text-white hover:text-blue-400 transition-colors"><i data-lucide="layout-grid" class="w-6 h-6"></i></button>
        <button onclick="switchView('target')" class="p-3 text-slate-400 hover:text-blue-400 transition-colors"><i data-lucide="crosshair" class="w-6 h-6"></i></button>
        
        <button onclick="document.getElementById('new-task-input').focus()" class="relative -top-6 bg-white text-black w-14 h-14 rounded-full flex items-center justify-center shadow-lg shadow-white/20">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>

        <button onclick="switchView('planner')" class="p-3 text-slate-400 hover:text-blue-400 transition-colors"><i data-lucide="calendar" class="w-6 h-6"></i></button>
        <button onclick="toggleMobileMenu()" class="p-3 text-slate-400 hover:text-blue-400 transition-colors"><i data-lucide="menu" class="w-6 h-6"></i></button>
    </nav>
    
    <div id="mobile-sidebar" class="fixed inset-y-0 right-0 w-64 bg-slate-900 border-l border-white/10 transform translate-x-full transition-transform duration-300 z-[60] p-6">
         <div class="flex justify-between items-center mb-8">
             <h3 class="font-bold text-white text-lg">Menu</h3>
             <button onclick="toggleMobileMenu(true)" class="text-slate-400"><i data-lucide="x"></i></button>
         </div>
         <div class="space-y-2">
             <button onclick="switchView('leaderboard')" class="w-full text-left p-3 rounded-xl hover:bg-white/10 text-white font-medium">Leaderboard</button>
             <button onclick="switchView('namaz')" class="w-full text-left p-3 rounded-xl hover:bg-white/10 text-white font-medium">Spiritual</button>
             <button onclick="switchView('mistakes')" class="w-full text-left p-3 rounded-xl hover:bg-white/10 text-white font-medium">Mistake Notebook</button>
             <div class="h-px bg-white/10 my-2"></div>
             <button onclick="openProfileModal()" class="w-full text-left p-3 rounded-xl hover:bg-white/10 text-white font-medium">Edit Profile</button>
         </div>
         <div class="hidden">
             <div id="mobile-sidebar-progress-text"></div>
             <div id="mobile-sidebar-progress-bar"></div>
             <div id="sidebar-progress-text"></div>
             <div id="sidebar-progress-bar"></div>
             <div id="desktop-sync-status"></div>
         </div>
    </div>
    <div id="mobile-menu-overlay" onclick="toggleMobileMenu(true)" class="fixed inset-0 bg-black/50 z-[55] hidden"></div>

    <div id="auth-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center">
        <div class="glass-card p-8 w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-4 text-white">StudyFlow</h2>
             <form id="auth-form" class="space-y-4">
                <input type="email" id="auth-email" placeholder="Email" class="w-full bg-white/10 border-none rounded-xl p-3 text-white">
                <input type="password" id="auth-pass" placeholder="Password" class="w-full bg-white/10 border-none rounded-xl p-3 text-white">
                <button type="button" onclick="handleAuth('login')" class="w-full bg-white text-black font-bold py-3 rounded-xl">Sign In</button>
            </form>
            <button onclick="startDemoMode()" class="mt-4 text-xs text-slate-400 hover:text-white underline">Offline Mode</button>
        </div>
    </div>
    
    <div id="profile-modal" class="hidden fixed inset-0 z-[110] bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
         <div class="glass-card p-6 w-full max-w-sm">
             <h3 class="text-xl font-bold text-white mb-4">Edit Profile</h3>
             <input type="text" id="profile-name-input" class="w-full bg-white/10 border-none rounded-xl p-3 text-white mb-4">
             <button onclick="saveProfileName()" class="w-full bg-white text-black font-bold py-3 rounded-xl">Save</button>
             <button onclick="document.getElementById('profile-modal').classList.add('hidden')" class="w-full mt-2 text-slate-400 text-sm">Cancel</button>
         </div>
    </div>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script type="module" src="script.js"></script>
    <script>
        // Init Icons
        lucide.createIcons();
    </script>
</body>


</html>